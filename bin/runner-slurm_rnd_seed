#!/bin/bash -l
# -*- mode: shell-script -*-
################################################################################
# runner-slurm_rnd_seed: cnn runner for SLURM with random seed --
# proof-of-concept for testing parallel patch extraction as patch coordinates
# are sampled over a uniform distribution.
#
# Use a job array where each task is scheduled automatically on a (possibly)
# different node/CPU
################################################################################
# For copyright see the `LICENSE` file.
#
# This file is part of PROCESS_UC1.
################################################################################
# Slurm batch control
#SBATCH --job-name=cnn-extr_rnd_seed
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --mem-per-cpu=5GB
#SBATCH --time=01:00:00
#SBATCH --account=process2
#SBATCH --partition=plgrid-testing
#SBATCH --array=0-9
#SBATCH --error=%x-%A_%3a.err
#SBATCH --output=%x-%A_%3a.out
################################################################################
# Job conf
PROJECT=PROCESS_UC1
SLURM_SUBMIT_DIR=${SCRATCH}/slurm_jobdir/${PROJECT}
CONF_DIR=${SCRATCH}/slurm_jobdir/${PROJECT}/conf    # MUST BE THERE
DATA_DIR=${SCRATCH}/slurm_jobdir/${PROJECT}/data    # ditto... with datasets in it
RESULTS_DIR=${SCRATCH}/slurm_jobdir/${PROJECT}/results

mkdir -p $RESULTS_DIR

################################################################################
# Start job
################################################################################

echo >&2 "[WARN] Test runner: some modules won't be loaded -- only for patch extraction"

# Note: env unset == False, anything else == True (avoid setting '0' for False)
PROCESS_UC1__HAS_SKIMAGE_VIEW=
PROCESS_UC1__HAS_TENSORFLOW=

export PROCESS_UC1__HAS_SKIMAGE_VIEW PROCESS_UC1__HAS_TENSORFLOW

# rewrite as job array

WIP...

echo "[BUG] not yet implemented" >&2
exit 1
